<div class="rounded-3 shadow-sm">
  <section class="">
    <h5 class="py-2 pe-2 ps-2 bg-success-subtle">Thông tin bệnh nhân</h5>
    <div class="mt-3 px-4 py-3">
      <div class="d-flex justify-content-start align-items-center">
        <p class="col-md-2"><strong>Tên bệnh nhân :</strong></p>
        <p class="col-md-10">
          <input
            class="input-none border border-1 p-2"
            ng-model="user.fullname"
            [value]="user?.fullname ?? 'Không'"
            (input)="currentFullNameChanged($event)"
          />
        </p>
      </div>
      <div class="d-flex justify-content-start align-items-center">
        <p class="col-md-2"><strong>Độ tuổi :</strong></p>
        <p class="col-md-10">
          <input
            class="input-none border border-1 p-2"
            ng-model="user.age"
            [value]="user?.age ?? 'Không'"
            (input)="currentAgeChanged($event)"
          />
        </p>
      </div>
      <div class="d-flex justify-content-start align-items-center">
        <p class="col-md-2"><strong>Giới Tính :</strong></p>
        <p class="col-md-10">
          <input
            class="input-none border border-1 p-2"
            ng-model="user.gender"
            [value]="user?.gender ?? 'Không'"
            (input)="currentGenderChanged($event)"
          />
        </p>
      </div>
      <button class="btn btn-success" (click)="updateInformation()">
        Thay đổi thông tin
      </button>
    </div>
    <h5 class="py-2 pe-2 ps-2 bg-success-subtle">
      Thông tin tình trạng sức khỏe
    </h5>
    <div class="mt-3 px-4 py-3">
      <div class="d-flex justify-content-start align-items-center row">
        <p class="col-md-4 col-lg-2">
          <strong>Triệu chứng chuyên nghành :</strong>
        </p>
        <p class="col-md-12 col-lg-10">
          <!-- <input value="{{ prescription?.symptoms ?? 'Không' }}" readonly /> -->
          {{ specializedSymptoms ?? "Không" }}
        </p>
      </div>
      <div class="d-flex justify-content-start align-items-center row">
        <p class="col-md-4 col-lg-2">
          <strong>Triệu chứng :</strong>
        </p>

        <div class="col-md-12 col-lg-10 custom-input-edit">
          <input
            class="border border-1"
            ng-model="prescription?.symptoms"
            [value]="prescription?.symptoms ?? 'Không'"
            (input)="currentSymptomsChange($event)"
          />
          <button class="btn btn-outline-success" (click)="updateSymptoms()">
            Thay đổi<i></i>
          </button>
        </div>
      </div>
      <div class="d-flex justify-content-start align-items-center row">
        <p class="col-md-4 col-lg-2"><strong>Bệnh nền :</strong></p>
        <div class="col-md-12 col-lg-10 custom-input-edit">
          <input
            class="border border-1"
            ng-model="prescription?.underlying_condition"
            [value]="prescription?.underlying_condition ?? 'Không'"
            (input)="currentUnderlyingChange($event)"
          />
          <button class="btn btn-outline-success" (click)="updateUnderlying()">
            Thay đổi<i></i>
          </button>
        </div>
      </div>
      <!-- <div class="d-flex justify-content-start align-items-center row">
        <p class="col-md-4 col-lg-2"><strong>Dị ứng thuốc :</strong></p>
        <p class="col-md-12 col-lg-10">
          <input
            class="input-none border border-1 p-2"
            ng-model="userAllergics"
            value="{{ userAllergics ?? 'Không' | join : ', ' }}"
            (change)="currentAllergicChange($event)"
          />
        </p>
        <button
          class="btn btn-success"
          style="width: max-content"
          (click)="updateAllergic()"
        >
          Thay đổi thành phần dị ứng
        </button>
      </div> -->
      <div class="d-flex justify-content-start align-items-center row">
        <p class="col-md-4 col-lg-2"><strong>Dị ứng thuốc :</strong></p>
        <div class="col-md-12 col-lg-10 custom-input-edit">
          <input
            class="border border-1"
            ng-model="userAllergics"
            value="{{ userAllergics ?? 'Không' | join : ', ' }}"
            (change)="currentAllergicChange($event)"
          />
          <button class="btn btn-outline-success" (click)="updateAllergic()">
            Thay đổi<i></i>
          </button>
        </div>
      </div>
    </div>
  </section>
  <section class="">
    <h5 class="py-2 pe-2 ps-2 bg-success-subtle flex-grow-1">
      Chuẩn đoán lâm sàng
    </h5>
    <div class="px-4 pt-3 mt-2">
      <form [formGroup]="addDiagnosisForm" (ngSubmit)="addDiagnosis()">
        <div class="mb-3 row">
          <div class="col-md-5">
            <input
              type="text"
              class="form-control"
              placeholder="Nhập tên bệnh..."
              aria-label="Nhập tên bệnh"
              formControlName="name"
            />
          </div>
          <div class="col-md-5">
            <select
              name="department"
              id=""
              class="form-control"
              formControlName="department"
            >
              <option value="" selected>Chọn Khoa</option>
              <option
                *ngFor="let item of departments"
                value="{{ item.name }}"
                selected
              >
                {{ item.name }}
              </option>
            </select>
          </div>
          <button class="btn btn-primary col-md-2" type="submit">
            <i class="fa-solid fa-plus me-1 text-white"></i>Thêm bệnh
          </button>
        </div>
      </form>
    </div>
    <div cdkDropList class="drop px-4 py-3" (cdkDropListDropped)="drop($event)">
      <div
        *ngFor="let item of diagnosis; let i = index"
        cdkDrag
        class="card w-100 px-3 py-2 d-flex flex-row justify-content-between align-items-center border-0 shadow-sm mb-1"
      >
        <div class="content flex-grow-1">
          <p class="fw-semibold">Bệnh: {{ item.name }}</p>
          <p class="fw-semibold m-0">
            Xác suất: {{ item.probability ? item.probability * 100 : 0 }}%
          </p>
          <p class="fw-semibold m-0">Khoa khám: {{ item.department }}</p>
        </div>
        <a
          (click)="deleteDiagnosis(item.id)"
          class="btn btn-outline-danger d-inline-flex justify-content-center align-items-center p-2 border rounded-1"
        >
          <i class="fas fa-trash-alt"></i>
        </a>
      </div>
    </div>
    <div class="d-flex px-4 pb-4 justify-content-center w-100">
      <button class="btn btn-success mx-auto" (click)="generateMedicine()">
        Chấp nhận đơn khám
      </button>
    </div>
  </section>
</div>
<ngx-spinner
  bdColor=" rgb(255,255,255)"
  size="medium"
  color="#198754"
  type="ball-clip-rotate-pulse"
  [fullScreen]="true"
>
  <p class="text-success w-100 mt-lg-5">Hệ thống đang xử lý...</p>
</ngx-spinner>
